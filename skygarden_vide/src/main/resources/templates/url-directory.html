<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common :: head('URLディレクトリ - Skygarden')}"></head>
<body>
    <!-- Sidebar -->
    <nav th:replace="~{fragments/common :: sidebar}"></nav>
    
    <!-- Header (Mobile) -->
    <nav th:replace="~{fragments/common :: header}"></nav>
    
    <!-- Offcanvas Menu (Mobile) -->
    <div th:replace="~{fragments/common :: offcanvas}"></div>
    
    <main>
        <section class="sky-list-container sky-section">
            <h1 class="ms-1 mb-3">URLディレクトリ</h1>
            
            <!-- タイプ別タブ -->
            <ul class="nav nav-tabs mb-4" id="directoryTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="content-tab" data-bs-toggle="tab" data-bs-target="#content-pane" type="button" role="tab" aria-controls="content-pane" aria-selected="true">
                        コンテンツ
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="template-tab" data-bs-toggle="tab" data-bs-target="#template-pane" type="button" role="tab" aria-controls="template-pane" aria-selected="false">
                        テンプレート
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="image-tab" data-bs-toggle="tab" data-bs-target="#image-pane" type="button" role="tab" aria-controls="image-pane" aria-selected="false">
                        画像
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file-pane" type="button" role="tab" aria-controls="file-pane" aria-selected="false">
                        ファイル
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="css-tab" data-bs-toggle="tab" data-bs-target="#css-pane" type="button" role="tab" aria-controls="css-pane" aria-selected="false">
                        CSS
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="js-tab" data-bs-toggle="tab" data-bs-target="#js-pane" type="button" role="tab" aria-controls="js-pane" aria-selected="false">
                        JS
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="movie-tab" data-bs-toggle="tab" data-bs-target="#movie-pane" type="button" role="tab" aria-controls="movie-pane" aria-selected="false">
                        動画
                    </button>
                </li>
            </ul>
            
            <!-- タブコンテンツ -->
            <div class="tab-content" id="directoryTabContent">
                <!-- コンテンツタブ -->
                <div class="tab-pane fade show active" id="content-pane" role="tabpanel" aria-labelledby="content-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${contentTree == null or contentTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されているコンテンツはありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${contentTree}, 'content', '')}"></div>
                    </div>
                </div>
                
                <!-- テンプレートタブ -->
                <div class="tab-pane fade" id="template-pane" role="tabpanel" aria-labelledby="template-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${templateTree == null or templateTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されているテンプレートはありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${templateTree}, 'template', '')}"></div>
                    </div>
                </div>
                
                <!-- 画像タブ -->
                <div class="tab-pane fade" id="image-pane" role="tabpanel" aria-labelledby="image-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${imageTree == null or imageTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されている画像はありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${imageTree}, 'image', '')}"></div>
                    </div>
                </div>
                
                <!-- ファイルタブ -->
                <div class="tab-pane fade" id="file-pane" role="tabpanel" aria-labelledby="file-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${fileTree == null or fileTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されているファイルはありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${fileTree}, 'file', '')}"></div>
                    </div>
                </div>
                
                <!-- CSSタブ -->
                <div class="tab-pane fade" id="css-pane" role="tabpanel" aria-labelledby="css-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${cssTree == null or cssTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されているCSSはありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${cssTree}, 'stylesheet', '')}"></div>
                    </div>
                </div>
                
                <!-- JSタブ -->
                <div class="tab-pane fade" id="js-pane" role="tabpanel" aria-labelledby="js-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${jsTree == null or jsTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されているJSはありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${jsTree}, 'script', '')}"></div>
                    </div>
                </div>
                
                <!-- 動画タブ -->
                <div class="tab-pane fade" id="movie-pane" role="tabpanel" aria-labelledby="movie-tab">
                    <div class="sky-directory-tree">
                        <div th:if="${movieTree == null or movieTree.isEmpty()}" class="text-muted ms-3">
                            URLが定義されている動画はありません
                        </div>
                        <div th:replace="~{url-directory :: treeNode(${movieTree}, 'movie', '')}"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer th:replace="~{fragments/common :: footer}"></footer>
    
    <!-- ツリーノードのフラグメント定義 -->
    <th:block th:fragment="treeNode(nodes, mode, parentPath)">
        <ul class="sky-tree-list" th:if="${nodes != null and !nodes.isEmpty()}">
            <li th:each="node : ${nodes}" class="sky-tree-item">
                <!-- ディレクトリの場合 -->
                <div th:if="${node.isDirectory}" class="sky-tree-folder">
                    <span class="sky-tree-toggle" onclick="toggleTreeNode(this)">
                        <span class="sky-tree-icon sky-tree-icon-folder">&#128193;</span>
                        <span class="sky-tree-name" th:text="${node.name}"></span>
                    </span>
                    <div th:replace="~{url-directory :: treeNode(${node.children}, ${mode}, ${node.path})}"></div>
                </div>
                <!-- ファイル（コンテンツ）の場合 -->
                <div th:if="${!node.isDirectory}" class="sky-tree-file">
                    <a th:href="@{'/content?mode=' + ${mode} + '&id=' + ${node.id}}" class="sky-tree-link">
                        <span class="sky-tree-icon sky-tree-icon-file">&#128196;</span>
                        <span class="sky-tree-name" th:text="${node.name}"></span>
                        <span class="sky-tree-title text-muted ms-2" th:if="${node.title != null and !node.title.isEmpty()}" th:text="'(' + ${node.title} + ')'"></span>
                    </a>
                </div>
            </li>
        </ul>
    </th:block>
    
    <style>
        .sky-directory-tree {
            background-color: var(--sky-bg-2, #f8f9fa);
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        .sky-tree-list {
            list-style: none;
            padding-left: 0;
            margin: 0;
        }
        
        .sky-tree-list .sky-tree-list {
            padding-left: 24px;
            border-left: 1px solid #dee2e6;
            margin-left: 10px;
        }
        
        .sky-tree-item {
            margin: 4px 0;
        }
        
        .sky-tree-folder {
            cursor: pointer;
        }
        
        .sky-tree-toggle {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .sky-tree-toggle:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .sky-tree-file {
            padding-left: 4px;
        }
        
        .sky-tree-link {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .sky-tree-link:hover {
            background-color: rgba(255, 193, 7, 0.2);
            color: inherit;
        }
        
        .sky-tree-icon {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .sky-tree-icon-folder {
            color: #ffc107;
        }
        
        .sky-tree-icon-file {
            color: #6c757d;
        }
        
        .sky-tree-name {
            font-weight: 500;
        }
        
        .sky-tree-title {
            font-size: 0.85em;
            font-weight: normal;
        }
        
        .sky-tree-folder > .sky-tree-list {
            display: block;
        }
        
        .sky-tree-folder.collapsed > .sky-tree-list {
            display: none;
        }
        
        /* タブスタイル */
        .nav-tabs .nav-link {
            color: #495057;
            border: 1px solid transparent;
        }
        
        .nav-tabs .nav-link:hover {
            border-color: #e9ecef #e9ecef #dee2e6;
        }
        
        .nav-tabs .nav-link.active {
            color: #495057;
            background-color: var(--sky-bg-2, #f8f9fa);
            border-color: #dee2e6 #dee2e6 var(--sky-bg-2, #f8f9fa);
        }
        
        /* ROOTラベル */
        .sky-tree-list > .sky-tree-item:first-child > .sky-tree-folder > .sky-tree-toggle::before {
            content: "";
        }
    </style>
    
    <script>
        function toggleTreeNode(element) {
            const folder = element.closest('.sky-tree-folder');
            folder.classList.toggle('collapsed');
        }
        
        // ページ読み込み時にすべてのフォルダを展開状態にする
        document.addEventListener('DOMContentLoaded', function() {
            // 初期状態は展開
        });
    </script>
</body>
</html>
